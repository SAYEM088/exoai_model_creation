<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Exoplanet Predictor</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center">

  <div class="bg-gray-800 p-8 rounded-2xl shadow-xl w-full max-w-3xl">
    <h1 class="text-3xl font-bold mb-6 text-center">Exoplanet Classification</h1>

    <!-- JSON Textarea -->
    <textarea id="jsonInput" rows="12" 
      class="w-full p-3 rounded bg-gray-700 text-white font-mono text-sm"
      placeholder='Paste JSON here (single object or array of objects)'></textarea>

    <button id="predictBtn" 
      class="mt-4 w-full bg-blue-600 hover:bg-blue-700 p-3 rounded font-semibold transition">
      Predict
    </button>
  </div>

  <!-- Modal -->
  <div id="resultModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center transition-opacity">
    <div class="bg-gray-800 p-6 rounded-2xl shadow-2xl w-full max-w-2xl text-center transform transition-all scale-95 opacity-0" id="modalContent">
      <h2 class="text-2xl font-bold mb-6">Prediction Result</h2>
      <div id="predictionContainer" class="space-y-4"></div>
      <button onclick="closeModal()" 
        class="mt-6 bg-red-600 px-5 py-2 rounded-lg hover:bg-red-700 transition font-semibold">
        Close
      </button>
    </div>
  </div>

  <script>
    const btn = document.getElementById("predictBtn");
    const modal = document.getElementById("resultModal");
    const modalContent = document.getElementById("modalContent");
    const container = document.getElementById("predictionContainer");

    // Color mapping
    const statusColors = {
      "CONFIRMED": "bg-green-600",
      "CANDIDATE": "bg-yellow-500",
      "FALSE POSITIVE": "bg-red-600"
    };

    btn.addEventListener("click", async () => {
      try {
        const jsonStr = document.getElementById("jsonInput").value;
        const jsonData = JSON.parse(jsonStr);

        const res = await fetch("http://127.0.0.1:8000/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(jsonData)
        });

        const data = await res.json();
        const predictions = data.predictions || [];

        container.innerHTML = "";

        if (Array.isArray(jsonData)) {
          // Multiple inputs -> show table
          let table = `<table class="w-full border border-gray-600 text-left text-sm">
                        <thead class="bg-gray-700">
                          <tr>
                            <th class="p-2 border border-gray-600">#</th>
                            <th class="p-2 border border-gray-600">Prediction</th>
                          </tr>
                        </thead>
                        <tbody>`;
          predictions.forEach((pred, i) => {
            const color = statusColors[pred] || "bg-gray-500";
            table += `<tr class="hover:bg-gray-700">
                        <td class="p-2 border border-gray-600">${i + 1}</td>
                        <td class="p-2 border border-gray-600">
                          <span class="px-3 py-1 rounded ${color} text-white font-semibold">${pred}</span>
                        </td>
                      </tr>`;
          });
          table += "</tbody></table>";
          container.innerHTML = table;
        } else {
          // Single input -> show status card
          const pred = predictions[0];
          const color = statusColors[pred] || "bg-gray-500";
          container.innerHTML = `
            <div class="p-6 rounded-xl shadow-lg ${color}">
              <p class="text-xl font-bold">${pred}</p>
            </div>`;
        }

        modal.classList.remove("hidden");
        setTimeout(() => {
          modalContent.classList.remove("scale-95", "opacity-0");
          modalContent.classList.add("scale-100", "opacity-100");
        }, 50);

      } catch (err) {
        alert("Invalid JSON input!");
      }
    });

    function closeModal() {
      modalContent.classList.add("scale-95", "opacity-0");
      setTimeout(() => {
        modal.classList.add("hidden");
      }, 200);
    }
  </script>

</body>
</html>
